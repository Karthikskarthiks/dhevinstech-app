{% extends 'base.html' %}

{% block content %}

<div class="container-fluid my-5" style="width:100%;">

  <!-- Page Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold text-dark">Work Details</h2>
    <a href="{% url 'add_workdetail' %}" class="btn btn-success shadow-sm">
      + Add Work
    </a>
  </div>

  <!-- ‚úÖ Back Button (Visible only when filtered) -->
  {% if is_filtered %}
  <div class="text-center mb-3">
    <a href="{% url 'workdetail_list' %}" 
       class="btn back-btn px-4 py-2">
       ‚Üê Back to All Work Details
    </a>
  </div>
  {% endif %}

  <!-- üîç Filter Section -->
  <div class="card shadow-sm mb-4 border-0 rounded-4">
    <div class="card-body">
      <form method="GET">
        <div class="row g-3">

          <div class="col-md-2">
            <label class="form-label fw-semibold">Date</label>
            <input type="date" name="date" 
                   value="{{ date_query }}"
                   class="form-control">
          </div>

          <div class="col-md-2">
            <label class="form-label fw-semibold">Labour</label>
            <input type="text" name="labour" 
                   value="{{ labour_query }}"
                   class="form-control"
                   placeholder="Enter Labour Name">
          </div>

          <div class="col-md-2">
            <label class="form-label fw-semibold">Vendor</label>
            <input type="text" name="vendor" 
                   value="{{ vendor_query }}"
                   class="form-control"
                   placeholder="Enter Vendor Name">
          </div>

          <div class="col-md-2">
            <label class="form-label fw-semibold">Site</label>
            <input type="text" name="site" 
                   value="{{ site_query }}"
                   class="form-control"
                   placeholder="Enter Site Name">
          </div>

          <div class="col-md-2 d-flex align-items-end">
            <button type="submit" class="btn btn-dark w-100">
              Filter
            </button>
          </div>

          <div class="col-md-2 d-flex align-items-end">
            <a href="{% url 'workdetail_list' %}" 
               class="btn btn-secondary w-100">
              Reset
            </a>
          </div>

        </div>
      </form>
    </div>
  </div>

  <!-- Table Section -->
  <div class="card shadow-lg border-0 rounded-4">
    <div class="card-body p-4">

      <div class="table-responsive">
        <table class="table table-hover align-middle text-center">

          <thead class="table-dark">
            <tr>
              <th>Date</th>
              <th>Labour</th>
              <th>Vendor</th>
              <th>Site</th>
              <th>Work Details</th>
              <th>Material</th>
              <th>Check In</th>
              <th>Check Out</th>
              <th>Actions</th>
            </tr>
          </thead>

          <tbody>
            {% for wd in workdetails %}
            <tr>
              <td class="fw-semibold" style="width: 0.5px;">{{ wd.date }}</td>

              <td style="width: 3px;">
                {% for labour in wd.labours.all %}
                  <span class="badge bg-secondary">
                    {{ labour.name }}
                  </span>
                {% empty %}
                  <span class="text-muted">No Labour</span>
                {% endfor %}
              </td>

              <td>{{ wd.vendor }}</td>

              <td>
                <span class="badge bg-info text-dark" style="white-space: normal;">
                  {{ wd.site.site_name }}<br>
                  {{ wd.site.location }}
                </span> 
              </td>

              <td style="white-space: normal;">
                {{ wd.work_description|linebreaksbr }}
              </td>

              <td>
                {% if wd.material_description %}
                    {{ wd.material_description|linebreaksbr }}
                {% else %}
                    -
                {% endif %}
              </td>
              
              <td>
                {% if wd.check_in %}
                  <span class="badge bg-success">
                    {{ wd.check_in|date:"h:i A" }}
                  </span>
                {% else %}
                  -
                {% endif %}
              </td>

              <td>
                {% if wd.check_out %}
                  <span class="badge bg-danger">
                    {{ wd.check_out|date:"h:i A" }}
                  </span>
                {% else %}
                  -
                {% endif %}
              </td>

              <td>
                <a href="{% url 'edit_workdetail' wd.id %}" 
                   class="btn btn-outline-primary btn-sm rounded-pill me-2">
                   Edit
                </a>

                <a href="{% url 'delete_workdetail' wd.id %}" 
                   class="btn btn-outline-danger btn-sm rounded-pill"
                   onclick="return confirm('Are you sure you want to delete this record?');">
                   Delete
                </a>
              </td>
            </tr>

            {% empty %}
            <tr>
              <td colspan="9" class="text-muted py-4">
                No Work Details Found
              </td>
            </tr>
            {% endfor %}
          </tbody>

        </table>
      </div>

    </div>
  </div>

</div>

<!-- üî• Animated Button CSS -->
<style>
.back-btn {
    background: linear-gradient(45deg, #0d6efd, #6610f2);
    color: white;
    border-radius: 30px;
    font-weight: 600;
    transition: all 0.4s ease;
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
}

.back-btn:hover {
    transform: translateY(-4px) scale(1.05);
    box-shadow: 0 10px 25px rgba(0,0,0,0.3);
    color: white;
}

.back-btn:active {
    transform: scale(0.95);
}
</style>

{% endblock %}